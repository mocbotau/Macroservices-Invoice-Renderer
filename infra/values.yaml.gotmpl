# yaml-language-server: $schema=../../infra-helm-charts/charts/generic-app/values.schema.json
environment: "prod"
version: {{ requiredEnv "COMMIT_SHA" | quote }}

deployments:
  - name: "macroservices-backend"
    image: "mocbotau/cloud:macroservices-backend-prod"
    environment:
      HOST: "0.0.0.0"
      PORT: "8000"
      I18N_NEXUS_API_KEY: "/secrets/i18n-nexus-api-key"
    secretProviderClass:
      projectId: "1523620a-e2b9-4772-a5b3-99db47e19172"
      secrets:
        - fileName: "i18n-nexus-api-key"
          secretKey: "I18N_NEXUS_API_KEY"
    service:
      port: 8000
    ingress:
      subdomain: "macroservices"
      domain: "masterofcubesau.com"
    readinessProbe:
      httpGet:
        port: 8000
        path: "/api/v3/healthcheck"
    volumes:
      - name: "macroservices-backend-data-longhorn"
        storageClass: "longhorn"
        mountPath: "/app/persistence"
        size: "1Gi"

  - name: "macroservices-frontend"
    image: "mocbotau/cloud:macroservices-frontend-prod"
    environment:
      BACKEND_URL: "http://service-macroservices-backend"
      BACKEND_PORT: "8000"
      SENDING_API: "dummy"
      NEXTAUTH_URL: "https://app-macroservices.masterofcubesau.com"
      FRONTEND_URL: "https://app-macroservices.masterofcubesau.com"
    service:
      port: 3000
    ingress:
      subdomain: "app-macroservices"
      domain: "masterofcubesau.com"
    secretProviderClass:
      projectId: "1523620a-e2b9-4772-a5b3-99db47e19172"
      syncAsKubernetesSecret: true
      secrets:
        - secretKey: "BACKEND_API_KEY"
        - secretKey: "NEXT_PUBLIC_COOKIE_KEY"
        - secretKey: "MAIL_USER"
        - secretKey: "MAIL_PASS"
        - secretKey: "NEXTAUTH_SECRET"
        - secretKey: "GOOGLE_CLIENT_ID"
        - secretKey: "GOOGLE_CLIENT_SECRET"
        - secretKey: "GITHUB_CLIENT_ID"
        - secretKey: "GITHUB_CLIENT_SECRET"
    readinessProbe:
      httpGet:
        port: 3000
        path: /
    volumes:
      - name: "macroservices-frontend-data-longhorn"
        storageClass: "longhorn"
        mountPath: "/app/persistence"
        size: "1Gi"
